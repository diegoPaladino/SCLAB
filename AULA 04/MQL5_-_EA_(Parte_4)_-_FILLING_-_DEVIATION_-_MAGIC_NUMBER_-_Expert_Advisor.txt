
#include <Trade\Trade.mqh>
CTrade trade;

void OnTick()
  {
      trade.SetTypeFilling1(ORDER_FILLING_RETURN);
      trade.SetDeviationInPoints(50);
      trade.SetExpertMagicNumber(123456);
      
      double ask, bid, last;
      double smaArray[];
      int smaHandle;
      
      ask = SymbolInfoDouble(_Symbol, SYMBOL_ASK);
      bid = SymbolInfoDouble(_Symbol, SYMBOL_BID);
      last = SymbolInfoDouble(_Symbol, SYMBOL_LAST);
      
      smaHandle = iMA(_Symbol, _Period, 200, 0, MODE_SMA, PRICE_CLOSE);
      ArraySetAsSeries(smaArray, true);
      CopyBuffer(smaHandle, 0, 0, 3, smaArray);
      
      if(last>smaArray[0] && PositionsTotal()==0)
         {
            Comment("Compra");
            trade.Buy(100, _Symbol, ask, ask-0.5, ask+0.5, "");
         }
      else if(last<smaArray[0] && PositionsTotal()==0)
         {
            Comment("Venda");
            trade.Sell(100, _Symbol, bid, bid+0.5, bid-0.5, ""); 
         }
   
  }